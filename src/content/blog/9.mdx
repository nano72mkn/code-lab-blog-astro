---
title: "bundleã‚µã‚¤ã‚ºãŒ80%å‰Šæ¸›ã•ã‚ŒãŸFireBaseã®ãƒ™ãƒ¼ã‚¿ç‰ˆã‚’ä½¿ç”¨ã—ã¦ã¿ãŸ"
published: true
pubDate: "2021-05-22"
tags: ["firebase"]
emoji: "ğŸ”¥"
---

å°‘ã—å‰ã«Twitterã§è¦‹ã‹ã‘ãŸ[ã“ã®å‹•ç”»ï¼ˆReducing bundle size: Previewing a new Firebase for the web | Sessionï¼‰](https://www.youtube.com/watch?v=r5eJQ3nPc6A)ã‚’ã¿ãŸã®ã§ã€æ—©é€Ÿä½¿ã£ã¦ã‚‹firebaseã‚’ã“ã®betaç‰ˆã«å·®ã—æ›¿ãˆã¦ã¿ãŸã„ã¨æ€ã„ã¾ã™ã€‚



## å·®ã—æ›¿ãˆã¦ã„ãã…
### npm install

å‹•ç”»ã®èª¬æ˜é€šã‚Šã«expã§installã™ã‚‹

```
$ npm i -S firebase@exp
```

ãã—ã¦ã€`import firebase from 'firebase/app';`ã¨ãŠåˆ¥ã‚Œã™ã‚‹ã ã‘ã€‚

```javascript:firebase.ts
import { FirebaseOptions, initializeApp } from 'firebase/app';

const firebaseConfig: FirebaseOptions = { ... };

export const firebaseApp = initializeApp(firebaseConfig);
```

åŸºæœ¬ã¯ã“ã‚“ãªæ„Ÿã˜ã€‚  
ãŸã ã€firebaseã®initã ã‘ã§ã¯ä½¿ãˆãªã„ã®ã§Authã‚‚initã—ã¾ã™ã€‚

ä»Šã¾ã§ã§ã‚ã‚Œã°ã€`import 'firebase/auth'`ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ã—ãŸãŒã€ã“ã‚“ã‚“ã‹ã„ã¯å°‘ã—å¤‰ã‚ã£ã¦

```javascript:firebase.ts
import { FirebaseOptions, initializeApp } from 'firebase/app';
import { initializeAuth } from 'firebase/auth';

const firebaseConfig: FirebaseOptions = { ... };

export const firebaseApp = initializeApp(firebaseConfig);
export const firebaseAuth = initializeAuth(firebaseApp);
```

firebaseã‚’ã¡ã‚‡ã“ã£ã¨ã¤ã‹ã†ãªã‚‰ã€ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

### ã‚¨ãƒ©ãƒ¼ã«å‡ºä¼šã†
nextjsã§å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€ã‚µãƒ³ãƒ—ãƒ«ã®ã‚ˆã†ã«ä¸Šè¨˜ã®ã¾ã¾ã§ã¯ä½¿ãˆã¾ã›ã‚“ã§ã—ãŸã€‚  
firebaseã‚ã‚‹ã‚ã‚‹ã¨è¨€ã„ã¾ã™ã‹ã€å®Ÿè£…ã™ã‚‹ãŸã³ã«å‰å›ã®è¨˜æ†¶ãªããªã£ã¦ã‚‹ã®ã§æ¯åº¦ãŠä¸–è©±ã«ãªã£ã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ã€‚

```
FirebaseError: Firebase: Firebase App named '[DEFAULT]' already exists (app/duplicate-app).
```

ã“ã„ã¤ã€‚  
å†…å®¹çš„ã«ã¯ã€ã€Œä½•å›ã‚‚åˆæœŸåŒ–ã™ã‚“ãªï¼ã€ã¨æ€’ã‚‰ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã™ã€‚

```javascript
import firebase from 'firebase/app';
...
if (firebase.apps.length === 0) {
  firebase.initializeApp(firebaseConfig);
}
```

ã„ã¾ã¾ã§ã¯ã€ã“ã®ã‚ˆã†ã«appsã®æ•°ã‚’ã¿ã¦ã¾ã åˆæœŸåŒ–ã•ã‚Œã¦ãªã„ã­ã£ã¦ç¢ºèªã—ã¦`initializeApp`ã‚’ã—ã¦ã¾ã—ãŸã€‚
ä»Šå›ã¯ã¡ã‚‡ã£ã¨å¤‰ã‚ã£ã¦ã€`firebase.apps.length`ã¯ãªã„ã§ã™ãŒ`getApps`ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã§

```javascript:firebase.ts
import { FirebaseOptions, getApp, getApps, initializeApp } from 'firebase/app';
import { getAuth, initializeAuth } from 'firebase/auth';

const firebaseConfig: FirebaseOptions = { ... };

export const firebaseApp =
  getApps().length === 0 ? initializeApp(firebaseConfig) : getApp();

export const firebaseAuth = getAuth(firebaseApp) || initializeAuth(firebaseApp);
```

ã“ã‚“ãªæ„Ÿã˜ã§`getApps`ãŒ`firebase.apps`ã®å½¹å‰²ã‚’ã—ã¦ã„ã¾ã™ã€‚
ã•ã‚‰ã«ã€authã§ã‚‚åŒã˜ã‚ˆã†ã«ä½•å›ã‚‚åˆæœŸåŒ–ã—ã¦ã‚‹ã¨ãŠã‚‚ã‚‰ã‚Œã‚‹ã®ã§`getAuth(firebaseApp)`ã§ã‚ã‚Œã°ãã®ã¾ã¾ã€ãªã‘ã‚Œã°åˆæœŸåŒ–ã—ã¦ã­ã¨ã„ã†ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ã¨ã‚Šã‚ãˆãšã€ã“ã‚Œã§å‹•ãã¾ã—ãŸã€‚

### æœ¬æ—¥ã®ç›®ç‰
ã§ã¯ã€ä»Šå›ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§æ³¨ç›®ã•ã‚Œã¦ã„ã‚‹bundle sizeã§ã™ãŒ....


```javascript:å¤‰æ›´å‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
Page                              Size     First Load JS
...
+ First Load JS shared by all     199 kB
...
```

```javascript:å¤‰æ›´å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º
Page                              Size     First Load JS
...
+ First Load JS shared by all     159 kB
...
```

40kBã‚‚æ¸›ã‚‰ã™ã“ã¨ãŒã§ãã¾ã—ãŸï¼  
æœ€é«˜ã§ã™ã­ï¼  

## ã¾ã¨ã‚

ã¾ã betaç‰ˆãªã®ã§ã€å®Ÿå‹™ã§å°å…¥ã¨ã„ã†ã®ã¯ã§ããã†ã«ãªã„ã§ã™ãŒã€è¶£å‘³ã®ç¯„å›²ã§ã¯æ¡ç”¨ã—ã¦ã„ã“ã†ã¨æ€ã£ã¦ã„ã¾ã™ï¼
